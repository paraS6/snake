function Main(){var e=new Snake.Menue.StartMenue;e.addMenueView();var t=new Snake.Sound.Soundregister;t.playAndLoad("menu.mp3");var n=function(){var e=new XMLHttpRequest;e.open("GET","./css/index.css",!0),e.send(null),e.onreadystatechange=function(){if(4===e.readyState)if(200===e.status){var t=document.getElementsByTagName("head")[0],n=document.createElement("link");n.setAttribute("href","./css/index.css"),n.setAttribute("rel","stylesheet"),n.setAttribute("type","text/css"),t.appendChild(n),createjs.Ticker.on("tick",stage)}else alert("Die angegebene Schriftart existiert nicht! Bitte versuchen sie es erneut!")}};n()}function startGame(e){var t=new Snake.Levels.Level;if(createjs.Sound.stop(),1==e){scoreTime=0;var n=new Snake.Sound.Soundregister;n.playAndLoad("level_1.mp3"),playingFieldImg=new createjs.Bitmap("img/spielfeld_level1.png"),dummyImg="img/level1_sprite_schwarz.png",doorImg=1}if(2==e){var i=new Snake.Sound.Soundregister;i.playAndLoad("level_2.mp3"),playingFieldImg=new createjs.Bitmap("img/spielfeld_level2.png"),dummyImg="img/level2_sprite_braun.png",doorImg=2}if(3==e){var a=new Snake.Sound.Soundregister;a.playAndLoad("level_3.mp3"),playingFieldImg=new createjs.Bitmap("img/spielfeld_level3.png"),dummyImg="img/level3_sprite_braun.png",doorImg=3}t.setSpeed(e);var s=t.getSpeed(),r=new Snake.Controlls.GameController;r.init(s,playingFieldImg,dummyImg,doorImg)}function addHighScoreToForm(){document.onkeydown=function(e){if(32==e.keyCode)return!1},document.getElementById("highscore-container").style.display="block",document.getElementById("highscore").style.display="block",document.getElementsByTagName("h1")[0].style.display="block",document.getElementById("highscore").onsubmit=function(){return window.XMLHttpRequest?xmlhttp=new XMLHttpRequest:xmlhttp=new ActiveXObject("Microsoft.XMLHTTP"),xmlhttp.onreadystatechange=function(){4==xmlhttp.readyState&&200==xmlhttp.status&&(document.getElementById("highscore-container").style.display="none",document.getElementById("highscore").style.display="none",writeHighscore(xmlhttp.responseText))},xmlhttp.open("POST","http://janabo.de/prison-snake/highscore.php",!0),xmlhttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),xmlhttp.send("name="+document.getElementById("name").value+"&punkte="+scoreTime),this.onsubmit=function(){return!1},!1}}function writeHighscore(e){var t=JSON.parse(e),n="";for(i=0;i<t.length;i++)n+="<tr><td>"+(i+1)+".</td><td>"+t[i].name+"</td><td>"+t[i].punkte+"</td></tr>";document.getElementsByTagName("tbody")[0].innerHTML=n,document.getElementsByTagName("table")[0].style.display="block",document.getElementsByTagName("h2")[0].style.display="block",document.getElementsByTagName("h1")[0].style.display="none",document.getElementById("highscore-container").style.display="block",document.onkeydown=function(e){if(32==e.keyCode)return!1}}function closeHighscore(){document.getElementsByTagName("table")[0].style.display="none",document.getElementById("highscore").style.display="none",document.getElementById("highscore-container").style.display="none",document.getElementsByTagName("h2")[0].style.display="none",document.getElementsByTagName("h1")[0].style.display="none",document.onkeydown=function(e){if(32==e.keyCode){var t=new Snake.Menue.Level;stage.removeAllChildren(),_level=1,t.addLevelView(_level)}}}var Snake=Snake||{},stage=new createjs.Stage("myCanvas");const WIDTH=stage.canvas.width-200,CELL=40,EMPTY=0,WALL=1,SNAKE_HEAD=2,PRISONER=3,TUNA=4,CIGARETTES=5,KNIFE=6,KEY=8,GATE=9;var scoreTime=0,playingFieldImg,dummyImg,doorImg;Snake.Menue=Snake.Menue||{};var _level=1;Snake.Menue.StartMenue=function(){var e=new Snake.Menue.Buttons("img/spiel_starten_button.png",0,0),t=new Snake.Menue.Buttons("img/anleitung_button.png",0,70),n=new Snake.Menue.Buttons("img/highscore_button.png",0,140);this.menueWindow=function(e,t,n){var i=new createjs.Container,a=new createjs.Shape,s=new createjs.Text(e,"80px pixel","white"),r=s.getBounds();return s.x=(stage.canvas.width-r.width)/2+t,s.y=stage.canvas.height/4+n,a.graphics.beginFill("black").drawRect(0,0,stage.canvas.width,stage.canvas.height),i.addChild(a,s),i},this.addMenueView=function(){var i=new createjs.Bitmap("img/spielstart.png");stage.addChild(i,e,t,n),stage.update(),document.onkeydown=function(e){if(32==e.keyCode){var t=new Snake.Menue.Level;stage.removeAllChildren(),t.addLevelView(_level)}},e.addEventListener("click",function(e){var t=new Snake.Menue.Level;stage.removeAllChildren(),t.addLevelView(_level)}),t.addEventListener("click",function(e){var t=new Snake.Menue.Instructions;stage.removeAllChildren(),t.addInstructionView()}),n.addEventListener("click",function(e){Snake.Menue.Highscore()})}},Snake.Menue.Instructions=function(){var e=new Snake.Menue.Buttons("img/close.png",540,(-250));this.addInstructionView=function(){var t=new createjs.Bitmap("img/instructions.png");stage.addChild(t,e),stage.update(),e.addEventListener("click",function(n){stage.removeChild(t,e);var i=new Snake.Menue.StartMenue;i.addMenueView()})}},Snake.Menue.Level=function(){var e=new Snake.Menue.Buttons("img/level_starten.png",0,0);this.addLevelView=function(t){var n=new createjs.Bitmap("img/tower_of_london_intro.png"),i=new createjs.Bitmap("img/alcatraz_intro.png"),a=new createjs.Bitmap("img/guantanamo_intro.png");1==t?(stage.addChild(n,e),stage.update()):2==t?(stage.addChild(i,e),stage.update()):3==t&&(stage.addChild(a,e),stage.update()),document.onkeydown=function(e){32==e.keyCode&&(stage.removeAllChildren(),startGame(t),_level++)},e.addEventListener("click",function(e){stage.removeAllChildren(),startGame(t),_level++})}},Snake.Menue.Buttons=function(e,t,n){var i=new createjs.Bitmap(e),a=t,s=n;return i.scaleX=.5,i.scaleY=.5,i.x=(stage.canvas.width-257)/2+a,i.y=stage.canvas.height/2+s,i},Snake.Menue.GameOver=function(){var e=new createjs.Bitmap("img/gameover_screen.png"),t=new Snake.Menue.Buttons("img/spiel_neu_starten.png",0,20),n=new Snake.Menue.Buttons("img/highscore_button.png",0,100);this.addGameOverView=function(){stage.addChild(e,t,n),stage.update();var i=new Snake.Sound.Soundregister;i.playAndLoad("gameover_song.mp3"),document.onkeydown=function(e){if(32==e.keyCode){stage.removeAllChildren(),_level=1;var t=new Snake.Menue.Level;t.addLevelView(_level)}},n.addEventListener("click",function(e){Snake.Menue.Highscore()}),t.addEventListener("click",function(e){stage.removeAllChildren(),_level=1;var t=new Snake.Menue.Level;t.addLevelView(_level)})}},Snake.Menue.NextLevel=function(){var e=new Snake.Menue.Buttons("img/naechstes_level.png",0,0),t=(new Snake.Menue.StartMenue).menueWindow("Ausbruch erfolgreich!",0,0),n=new Snake.Menue.Buttons("img/spiel_neu_starten.png",0,0),i=(new Snake.Menue.StartMenue).menueWindow("Du bist ein \rAusbrecherk√∂nig!",0,0),a=new Snake.Menue.Buttons("img/highscore_button.png",0,100);this.addNextLevelView=function(){if(createjs.Sound.stop(),_level<4){stage.addChild(t,e);var s=new Snake.Sound.Soundregister;s.playAndLoad("menu.mp3"),e.addEventListener("click",function(e){stage.removeAllChildren();var t=new Snake.Menue.Level;t.addLevelView(_level)}),document.onkeydown=function(e){if(32==e.keyCode){stage.removeAllChildren();var t=new Snake.Menue.Level;t.addLevelView(_level)}}}else{stage.addChild(i,n,a);var r=new Snake.Sound.Soundregister;r.playAndLoad("winning_complete.mp3");var o=new Snake.Sound.Soundregister;o.playAndLoad("gameover_song.mp3"),document.onkeydown=function(e){if(32==e.keyCode){stage.removeAllChildren(),_level=1;var t=new Snake.Menue.Level;t.addLevelView(_level)}},a.addEventListener("click",function(e){Snake.Menue.Highscore()}),n.addEventListener("click",function(e){stage.removeAllChildren(),_level=1,console.log("LEVEL:"+_level);var t=new Snake.Menue.Level;t.addLevelView(_level)}),addHighScoreToForm()}stage.update()}},Snake.Menue.Highscore=function(){window.XMLHttpRequest?xmlhttp=new XMLHttpRequest:xmlhttp=new ActiveXObject("Microsoft.XMLHTTP"),xmlhttp.onreadystatechange=function(){4==xmlhttp.readyState&&200==xmlhttp.status&&writeHighscore(xmlhttp.responseText)},xmlhttp.open("GET","http://janabo.de/prison-snake/highscore.php"),xmlhttp.send()},Snake.Controlls=Snake.Controlls||{},Snake.Controlls.GameController=function(){function e(e){switch(e.keyCode){case n:L.direction!=l&&I&&(L.direction=c),I=!1;break;case i:L.direction!=c&&I&&(L.direction=l),I=!1;break;case a:L.direction!=g&&I&&(L.direction=u),I=!1;break;case s:L.direction!=u&&I&&(L.direction=g),I=!1}}function t(e){var t=L.last.x,n=L.last.y;switch(L.direction){case"left":t--,I=!0;break;case"right":t++,I=!0;break;case"up":n--,I=!0;break;case"down":n++,I=!0}if(E.get(t,n)==WALL||E.get(t,n)==SNAKE_HEAD){createjs.Sound.stop();var i=new Snake.Sound.Soundregister;return i.playAndLoad("gameover_sound.mp3"),T=!0,stage.removeAllChildren(),createjs.Ticker.paused=!0}if(E.get(t,n)==GATE){var a=new Snake.Sound.Soundregister;return a.playAndLoad("win.mp3"),_=!0,stage.removeAllChildren(),createjs.Ticker.paused=!0}y.trackItems(E);var s;if(E.get(t,n)==PRISONER){var r=new Snake.Sound.Soundregister;r.playAndLoad("good_item.mp3"),s={x:t,y:n,d:L.direction},M++,y.setPrisoner(E),y.setCounter(M),L.insert(s.x,s.y,s.d),v.addPrisonerSprite(L,C,h),C++}else s=L.remove(),E.set(EMPTY,s.x,s.y),s.x=t,s.y=n,s.d=L.direction,L.insert(s.x,s.y,s.d);y.setRandomItem(E),w.setScore(E,t,n);var o=w.get();y.keySetter(o,E),w.getKeyStatus()&&E.set(GATE,9,0),E.set(SNAKE_HEAD,s.x,s.y)}const n=37,i=39,a=38,s=40,r=stage.canvas.height-40,o=parseInt(WIDTH/CELL),d=parseInt(r/CELL),l="right",c="left",u="up",g="down";var m,h,p,v=new Snake.Views.PrisonSnakeView,w=new Snake.Models.Score,S=new Snake.Views.ScoreView,k=new Snake.Menue.GameOver,f=new Snake.Menue.NextLevel,y=new Snake.Models.Collectibles,L=new Snake.Models.PrisonSnake,E=new Snake.Models.Grid,T=!1,_=!1,M=1,C=1,I=!1;this.init=function(e,t,n,i){m=t,h=n,p=i;var a=3,s=3;E.init(WALL,EMPTY,o,d),L.init("right",a,s),E.set(SNAKE_HEAD,a,s),y.setPrisoner(E),y.setCollectibles(E),createjs.Ticker.setFPS(e),createjs.Ticker.addEventListener("tick",this.handleTick),createjs.Ticker.RAF=!0,createjs.Ticker.paused=!1},this.initTicker=function(e){createjs.Ticker.setFPS(e),createjs.Ticker.addEventListener("tick",this.handleTick),createjs.Ticker.paused=!1},this.levelFinished=function(e,t){var n=!1,i=w.get();return t.last==GATE&&i>400&&(n=!0),n};var A=this;this.handleTick=function(){createjs.Ticker.paused===!1?A.gameLoop():T?(createjs.Ticker.removeEventListener("tick",A.handleTick),k.addGameOverView()):_&&(scoreTime+=w.getScoreTime(new Date),console.log(scoreTime),createjs.Ticker.removeEventListener("tick",A.handleTick),f.addNextLevelView())},this.gameLoop=function(){t(),S.drawScore(w,m),v.drawSnake(E,L,p),document.onkeydown=e,stage.update()}},Snake.Sound={},Snake.Sound.Soundregister=function(){var e="sfx/",t=[{src:"level_1.mp3",id:"level1"},{src:"level_2.mp3",id:"level2"},{src:"level_3.mp3",id:"level3"},{src:"menu.mp3",id:"menu"},{src:"good_item.mp3",id:"goodItem"},{src:"bad_item.wav",id:"badItem"},{src:"key.mp3",id:"key"},{src:"win.mp3",id:"winning"},{src:"winning_complete.mp3",id:"winning_complete"},{src:"gameover_sound.mp3",id:"gameover_sound"},{src:"gameover_song.mp3",id:"gameover_song"}];createjs.Sound.registerSounds(t,e),this.playAndLoad=function(e){createjs.Sound.play("sfx/"+e)},this.stop=function(){createjs.Sound.stop()}},Snake.Levels=Snake.Levels||{},Snake.Levels.Level=function(){var e,t=0;this.getId=function(){return e},this.setId=function(t){e=t},this.setSpeed=function(e){1==e?t=5:2==e?t=7:3==e&&(t=9)},this.getSpeed=function(){return t}},Snake.Views=Snake.Views||{},Snake.Views.PrisonSnakeView=function(){var e=new createjs.Bitmap("img/prisoner.png"),t=new createjs.Bitmap("img/items_tuna.png"),n=new createjs.Bitmap("img/item_cigarettes.png"),i=new createjs.Bitmap("img/item_knife.png"),a=new createjs.Bitmap("img/key.png"),s=new createjs.Bitmap("img/opendoor.png"),r=new createjs.Bitmap("img/opendoor_level3.png");this.createSprites=function(e){var t={images:[e],frames:{width:40,height:40},animations:{down:[0,2],left:[9,11],right:[4,6],up:[12,14],down2:[1,3],left2:[8,10],right2:[5,7],up2:[13,15]}},n=new createjs.SpriteSheet(t);return n};var o=[];o[0]={s:new createjs.Sprite(this.createSprites("img/sprites.png"),"right"),d:"right"},this.addPrisonerSprite=function(e,t,n){var i=e,a=t,s=n;o[a]={s:new createjs.Sprite(this.createSprites(s),i._queue[a].d),d:i._queue[a].d}},this.drawSnake=function(d,l,c){for(var u=d,g=l,m=c,h=0;h<u.width;h++)for(var p=0;p<u.heigth;p++){switch(u.get(h,p)){case SNAKE_HEAD:for(var v=0;v<g._queue.length;v++)if(h==g._queue[v].x&&p==g._queue[v].y){if(g._queue[v].d!=o[v].d){var w="2";v%2===0&&(w=""),o[v].s.gotoAndPlay(g._queue[v].d+w),o[v].d=g._queue[v].d+w}o[v].s.x=h*CELL,o[v].s.y=p*CELL,stage.addChild(o[v].s)}break;case PRISONER:var S=new createjs.Bitmap;S=e.clone(),S.x=h*CELL,S.y=p*CELL,stage.addChild(S);break;case KEY:var k=new createjs.Bitmap;k=a.clone(),k.x=h*CELL,k.y=p*CELL,stage.addChild(k);break;case GATE:var f=new createjs.Bitmap;1==m||2==m?f=s.clone():3==m&&(f=r.clone()),f.x=h*CELL,f.y=p*CELL,stage.addChild(f);break;case EMPTY:}switch(u.get(h,p).ITEM){case TUNA:var y=new createjs.Bitmap;y=t.clone(),y.x=h*CELL,y.y=p*CELL,stage.addChild(y);break;case CIGARETTES:var y=new createjs.Bitmap;y=n.clone(),y.x=h*CELL,y.y=p*CELL,stage.addChild(y);break;case KNIFE:var y=new createjs.Bitmap;y=i.clone(),y.x=h*CELL,y.y=p*CELL,stage.addChild(y)}}}},Snake.Views.ScoreView=function(){var e,t,n,i=new createjs.Container,a=new createjs.Text("Score","50px pixel","white"),s=a.getBounds();this.drawScore=function(r,o){var d=r.get(),l=r.getTime(new Date),c=o;t=new createjs.Text(l,"40px pixel","white"),t.x=WIDTH+(stage.canvas.width-WIDTH-t.getBounds().width)/2,t.y=.75*stage.canvas.height,a.x=WIDTH+(stage.canvas.width-WIDTH-s.width)/2,a.y=stage.canvas.height/4,e=new createjs.Text(d,"40px pixel","white"),n=e.getBounds(),e.x=WIDTH+(stage.canvas.width-WIDTH-n.width)/2,e.y=stage.canvas.height/4+60,i.addChild(c,a,e,t),stage.addChild(i)}},Snake.Models=Snake.Models||{};const MINIMUMSCOREKEYAPPEAR=400;Snake.Models.Grid=function(){width=null,heigth=null,_grid=null,this.init=function(e,t,n,i){this.width=n,this.heigth=i,this._grid=[];for(var a=0;a<n;a++){this._grid.push([]);for(var s=0;s<i;s++)0===a||0===s||a==n-1||s==i-1?this._grid[a].push(e):this._grid[a].push(t)}},this.set=function(e,t,n){this._grid[t][n]=e},this.get=function(e,t){return this._grid[e][t]}},Snake.Models.Score=function(){var e=0,t=!1,n=new Date;this.set=function(t){e+=t},this.get=function(){return e},this.setScore=function(e,n,i){if(e.get(n,i).ITEM==TUNA){var a=new Snake.Sound.Soundregister;a.playAndLoad("good_item.mp3"),this.set(30)}else if(e.get(n,i).ITEM==CIGARETTES){var s=new Snake.Sound.Soundregister;s.playAndLoad("good_item.mp3"),this.set(20)}else if(e.get(n,i)==PRISONER){var r=new Snake.Sound.Soundregister;r.playAndLoad("good_item.mp3"),this.set(10)}else if(e.get(n,i).ITEM==KNIFE){var o=new Snake.Sound.Soundregister;o.playAndLoad("bad_item.wav"),this.set(-50)}else if(e.get(n,i)==KEY){t=!0;var d=new Snake.Sound.Soundregister;d.playAndLoad("key.mp3")}},this.getKeyStatus=function(){return t},this.getTime=function(e){var t=parseInt((e-n)/1e3);if(s=t%60,m=parseInt(t/60),s<10)var i=m+":0"+s;else var i=m+":"+s;return i},this.getScoreTime=function(e){return parseInt((e-n)/1e3)}},Snake.Models.PrisonSnake=function(){direction=null,last=null,_queue=null,this.init=function(e,t,n){this.direction=e,this._queue=[],this.insert(t,n,e)},this.insert=function(e,t,n){this._queue.unshift({x:e,y:t,d:n}),this.last=this._queue[0]},this.remove=function(){return this._queue.pop()}},Snake.Models.Collectibles=function(){var e,t=!1;this.setKey=function(e){for(var t=e,n=[],i=0;i<t.width;i++)for(var a=0;a<t.heigth;a++)t.get(i,a)==EMPTY&&n.push({x:i,y:a});var s=n[Math.floor(Math.random()*n.length)];t.set(KEY,s.x,s.y)},this.keySetter=function(e,n){t===!1&&e>=MINIMUMSCOREKEYAPPEAR&&(this.setKey(n),t=!0)},this.setPrisoner=function(e){for(var t=e,n=[],i=0;i<t.width;i++)for(var a=0;a<t.heigth;a++)t.get(i,a)==EMPTY&&n.push({x:i,y:a});var s=n[Math.floor(Math.random()*n.length)];t.set(PRISONER,s.x,s.y)},this.setCollectibles=function(e){for(var t=[],n=0;n<e.width;n++)for(var i=0;i<e.heigth;i++)e.get(n,i)==EMPTY&&t.push({x:n,y:i});var a=t[Math.floor(Math.random()*t.length)],s={ITEM:this.generateRandomItem(),timer:new Date};e.set(s,a.x,a.y)},this.trackItems=function(e){for(var t=0;t<e.width;t++)for(var n=0;n<e.heigth;n++)switch(e.get(t,n).ITEM){case CIGARETTES:endTime=new Date,(endTime-e.get(t,n).timer)/1e3>=7&&e.set(EMPTY,t,n);break;case TUNA:endTime=new Date,(endTime-e.get(t,n).timer)/1e3>=7&&e.set(EMPTY,t,n);break;case KNIFE:endTime=new Date,(endTime-e.get(t,n).timer)/1e3>=15&&e.set(EMPTY,t,n)}},this.generateRandomItem=function(){var e=Math.floor(3*Math.random()+4);return e},this.getCounter=function(e){return e},this.setCounter=function(t){e=t},this.setRandomItem=function(t){this.getCounter(e),e%6===0&&(e=1,this.setCollectibles(t))}};